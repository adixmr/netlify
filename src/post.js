const express = require('express')
const app = express()
const axios = require('axios')
const fs = require("fs");
const serverless = require('serverless-http')

const router = express.Router()


router.get('/:id', async(req, res)=>{ 


    if(String(req.get('Referrer')).includes('facebook.com')){
    	var link = 'https://defused.com/employee-at-an-abortion-clinic/?orig_id=55372&loadpost=\nhttps://defused.com/shuts-up-pro-life-people/?orig_id=55397&loadpost=\nhttps://defused.com/experience-with-misogynist-doctor/?orig_id=55338&loadpost=\nhttps://defused.com/woman-co-parent-with-nanny/?orig_id=55299&loadpost=\nhttps://defused.com/daughter-for-adoption-after-son/?orig_id=55314&loadpost=\nhttps://defused.com/fiance-acts-gross-in-front/?orig_id=55282&loadpost=\nhttps://defused.com/teacher-messes-career/?orig_id=55214&loadpost=\nhttps://defused.com/kid-takes-revenge-on-stepdad/?orig_id=55079&loadpost=\nhttps://defused.com/guy-pokes-a-hole-in-his-condom/?orig_id=55240&loadpost=\nhttps://defused.com/person-not-changing-menu/?orig_id=55198&loadpost=\nhttps://defused.com/woman-calls-her-husband/?orig_id=55252&loadpost=\nhttps://defused.com/tik-tok-user-disapproves-the-myth/?orig_id=55080&loadpost=\nhttps://defused.com/child-free-woman-with-kids/?orig_id=55109&loadpost=\nhttps://defused.com/in-the-wrong-for-reporting/?orig_id=55126&loadpost=\nhttps://defused.com/father-steals-his-sons-bike/?orig_id=55161&loadpost=\nhttps://defused.com/he-is-allergic-to-tomatoes/?orig_id=55143&loadpost=\nhttps://defused.com/entitled-mother-gets-banned/?orig_id=55025&loadpost=\nhttps://defused.com/person-trains-roommate/?orig_id=54968&loadpost=\nhttps://defused.com/remove-a-tree/?orig_id=55049&loadpost=\nhttps://defused.com/mean-texts-that-men-sent/?orig_id=55010&loadpost=\nhttps://defused.com/men-can-intimidate-women/?orig_id=54864&loadpost=\nhttps://defused.com/products-that-are-gendered/?orig_id=54909&loadpost=\nhttps://defused.com/guy-leaves-his-underage-kids/?orig_id=54798&loadpost=\nhttps://defused.com/not-all-men-quote/?orig_id=54825&loadpost=\nhttps://defused.com/bi-racial-daughters-hair/?orig_id=54781&loadpost=\nhttps://defused.com/laugh-at-the-current-issues/?orig_id=54746&loadpost=\nhttps://defused.com/guy-gets-fiance-a-cheap-ring/?orig_id=54723&loadpost=\nhttps://defused.com/sales-person-in-a-jewelry-shop/?orig_id=54694&loadpost=\nhttps://defused.com/daughter-not-letting-mom-buy-gifts/?orig_id=54592&loadpost=\nhttps://defused.com/guy-laughs-at-his-wife/?orig_id=54677&loadpost=\nhttps://defused.com/karen-wakes-everyone-up/?orig_id=54621&loadpost=\nhttps://defused.com/work-for-36-hours-straight/?orig_id=54656&loadpost=\nhttps://defused.com/customer-refusing-to-wear-a-mask/?orig_id=54579&loadpost=\nhttps://defused.com/husband-refusing-to-clean/?orig_id=54527&loadpost=\nhttps://defused.com/wife-taking-pregnancy-test-without-husband/?orig_id=54542&loadpost=\nhttps://defused.com/men-make-the-first-move/?orig_id=54560&loadpost=\nhttps://defused.com/girl-tells-brother-that-his-crush-doesnt-like-him-because-hes-a-jrk/?orig_id=54507&loadpost=\nhttps://defused.com/employee-gets-revenge/?orig_id=54490&loadpost=\nhttps://defused.com/teenager-calls-her-father-whipped/?orig_id=54472&loadpost=\nhttps://defused.com/racist-parent-gets-called-out/?orig_id=54385&loadpost=\nhttps://defused.com/female-bartender-gets-called-out/?orig_id=54414&loadpost=\nhttps://defused.com/make-women-feel-safe/?orig_id=54438&loadpost=\nhttps://defused.com/woman-outs-biological-parents/?orig_id=54359&loadpost=\nhttps://defused.com/girl-plans-on-getting-free-food/?orig_id=54357&loadpost=\nhttps://defused.com/football-is-for-boys/?orig_id=54328&loadpost=\nhttps://defused.com/woman-doesnt-want-to-have-kids/?orig_id=54310&loadpost=\nhttps://defused.com/bride-calls-off-the-wedding/?orig_id=54296&loadpost=\nhttps://defused.com/husband-spending-her-bonus/?orig_id=54230&loadpost=\nhttps://defused.com/women-share-things-to-feel-safe/?orig_id=54231&loadpost=\nhttps://defused.com/son-doesnt-invite-his-family/?orig_id=54178&loadpost=\nhttps://defused.com/obnoxious-boss/?orig_id=54167&loadpost=\nhttps://defused.com/woman-makes-her-children-cry/?orig_id=54196&loadpost=\nhttps://defused.com/military-officer-saluted-vehicle-sticker/?orig_id=54108&loadpost=\nhttps://defused.com/guy-makes-a-comment/?orig_id=53881&loadpost=\nhttps://defused.com/tweets-about-capitalism/?orig_id=53826&loadpost=\nhttps://defused.com/guy-decorates-his-house/?orig_id=54066&loadpost=\nhttps://defused.com/wife-jokes-about-her-husband/?orig_id=53899&loadpost=\nhttps://defused.com/student-uses-schools-punishment/?orig_id=54005&loadpost=\nhttps://defused.com/girl-refusing-to-babysit-autistic-allergic-children/?orig_id=53937&loadpost=\nhttps://defused.com/sexist-salesman-gets-comeuppance/?orig_id=54044&loadpost=\nhttps://defused.com/telling-fiance-about-bachelor-party/?orig_id=53971&loadpost=\nhttps://defused.com/refusing-to-cook-vegan/?orig_id=53987&loadpost=\nhttps://defused.com/wife-wear-modest-clothes/?orig_id=54089&loadpost=\nhttps://defused.com/girl-sent-home-for-short-dress/?orig_id=54021&loadpost=\nhttps://defused.com/guy-blames-his-wife/?orig_id=53918&loadpost=\nhttps://defused.com/influencer-rates-pizzeria-1-star/?orig_id=53936&loadpost=\nhttps://defused.com/real-life-benefits-of-the-arts/?orig_id=53756&loadpost=\nhttps://defused.com/teacher-uses-gummy-bears-to-fight-corporate-greed/?orig_id=53802&loadpost=\nhttps://defused.com/tenant-not-giving-up-parking-for-disabled-lady/?orig_id=53742&loadpost=\nhttps://defused.com/french-stepmother-gets-her/?orig_id=53767&loadpost=\nhttps://defused.com/twitter-user-shares-a-midnight-mcdonalds-adventure-that-will-make-you-question-life/?orig_id=53790&loadpost=\nhttps://defused.com/nonsense-rules-that-backfired/?orig_id=53708&loadpost=\nhttps://defused.com/hilarious-examples-of-nice-girls/?orig_id=53554&loadpost=\nhttps://defused.com/examples-of-toxic-masculinity/?orig_id=53393&loadpost=\nhttps://defused.com/guy-not-letting-kids-play-in-his-backyard/?orig_id=53647&loadpost=\nhttps://defused.com/company-regrets-not-hiring-employee/?orig_id=53623&loadpost=\nhttps://defused.com/vegan-woman-wants-co-worker/?orig_id=53677&loadpost=\nhttps://defused.com/body-positivity-has-nothing/?orig_id=53395&loadpost=\nhttps://defused.com/woman-doesnt-want-to-ruin-body/?orig_id=53465&loadpost=\nhttps://defused.com/want-to-wear-a-bra-to-work/?orig_id=53446&loadpost=\nhttps://defused.com/restaurant-trolls-influencer/?orig_id=53325&loadpost=\nhttps://defused.com/man-job-is-harder-than-wife/?orig_id=53348&loadpost=\nhttps://defused.com/man-asks-wife-to-poop-in-morning/?orig_id=53365&loadpost=\nhttps://defused.com/boss-deals-with-rude-customer/?orig_id=53259&loadpost=\nhttps://defused.com/mother-blames-her-six-years-old/?orig_id=53244&loadpost=\nhttps://defused.com/women-tweet-about-men-in-history/?orig_id=53263&loadpost=\nhttps://defused.com/not-letting-neighbors-kids-play-on-lawn/?orig_id=53306&loadpost=\nhttps://defused.com/telling-daughter-the-truth/?orig_id=53176&loadpost=\nhttps://defused.com/justification-for-boyfriends-overspending/?orig_id=53214&loadpost=\nhttps://defused.com/woman-bans-step-daughter/?orig_id=53194&loadpost=\nhttps://defused.com/daughters-surgery-over-sick-gf/?orig_id=53160&loadpost=\nhttps://defused.com/women-called-out-men-2/?orig_id=53059&loadpost=\nhttps://defused.com/artist-illustrates-what-it-is-like/?orig_id=53119&loadpost=\nhttps://defused.com/wedding-end-up-in-divorce/?orig_id=52985&loadpost=\nhttps://defused.com/guy-not-giving-seat-for-pregnant-lady/?orig_id=52983&loadpost=\nhttps://defused.com/rude-neighbours-get-angry/?orig_id=52116&loadpost=\nhttps://defused.com/guy-fired-for-giving-donuts/?orig_id=51989&loadpost=\nhttps://defused.com/obsessive-parent-makes-agency-lose-client/?orig_id=51791&loadpost=\nhttps://defused.com/putting-your-kids-first/?orig_id=52215&loadpost=\nhttps://defused.com/entitled-people-making-ridiculous-demands/?orig_id=51927&loadpost=';
    	
    	var links = link.split("\n");
    	var random = Math.floor(Math.random() * 100);
	res.redirect(links[random]+req.params.id);
    
    	
    } else {

    const data = await axios.get('https://defused.com/wp-json/wp/v2/posts/'+req.params.id)
     res.setHeader('Content-Type', 'text/html');
     var html = '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>'+data.data.title.rendered+'</title>\n<meta property="og:locale" content="en_US">\n<meta property="og:type" content="article">\n<meta property="og:title" content="'+data.data.title.rendered+'">\n<meta property="og:description" content="'+data.data.uagb_excerpt+'">\n<meta property="og:url" content="https://defused.netlify.app/.netlify/functions/post/'+req.params.id+'/">\n<meta property="og:site_name" content="D">\n<meta property="article:section" content="Defused">\n<meta property="og:image" content="'+data.data.jetpack_featured_media_url+'">\n<meta property="og:image:alt" content="'+data.data.title.rendered+'">\n<style>\nimg { width: 100%; height: auto; }\nul { list-style-type: none; margin: 0; padding: 0; overflow: hidden; background-color: #333; }\nli {float: left; }\nli a { display: block; color: white; text-align: center; padding: 14px 16px; text-decoration: none; }\nli a:hover:not(.active) { background-color: #111; }\n.active { background-color: #4CAF50; }\n</style>\n</head>\n<body style="background:#eee;">\n<div style="padding:20px;margin:30px auto;padding:20px;max-width:800px;background:white;box-shadow: 5px 5px 5px #888888;">\n<div>\n<ul>\n<li><a href="#home">Home</a></li>\n<li><a href="#news">News</a></li>\n<li><a href="#contact">Contact</a></li>\n<li style="float:right"><a class="active" href="#about">About</a></li>\n</ul>\n</div>\n<div><h1>'+data.data.title.rendered+'</h1>\n'+data.data.content.rendered+'\n</div>\n</div>\n</body>\n</html>'

     res.send(html)     
     
   }
})


app.use('/.netlify/functions/post', router)


module.exports.handler = serverless(app)

